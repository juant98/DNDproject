<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Encuesta – Sesión del Viernes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .poll-box {
      background: white;
      padding: 25px 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 380px;
      text-align: center;
    }
    h2 {
      margin-bottom: 18px;
    }
    label {
      display: block;
      margin: 10px 0;
      cursor: pointer;
    }
    button {
      margin-top: 15px;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      background: #28a745;
      color: white;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover:enabled {
      background: #218838;
    }
    button:disabled {
      background: #a9a9a9;
      cursor: not-allowed;
    }
    .results {
      margin-top: 22px;
      text-align: left;
    }
    #resetButton {
      background: #dc3545;
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <div class="poll-box">
    <h2>¿Irás a la sesión de este Viernes?</h2>
    <form id="pollForm">
      <label>
        <input type="radio" name="vote" value="yes"> Iré a la sesión de este Viernes
      </label>
      <label>
        <input type="radio" name="vote" value="no"> No iré a la sesión de este Viernes
      </label>
      <button type="submit" id="voteButton">Votar</button>
    </form>

    <div class="results" id="results">
      <h3>Resultados:</h3>
      <p id="yesVotes">Iré: 0 votos</p>
      <p id="noVotes">No iré: 0 votos</p>
    </div>

    <button id="resetButton">Reiniciar votos</button>
  </div>

  <script>
    const form = document.getElementById("pollForm");
    const voteButton = document.getElementById("voteButton");
    const yesVotesEl = document.getElementById("yesVotes");
    const noVotesEl = document.getElementById("noVotes");
    const resetButton = document.getElementById("resetButton");

    // Fetch current counts
    async function fetchCounts() {
      const res = await fetch("/poll");
      const data = await res.json();
      updateUI(data);
    }

    function updateUI(data) {
      yesVotesEl.textContent = `Iré: ${data.yes} voto${data.yes === 1 ? "" : "s"}`;
      noVotesEl.textContent = `No iré: ${data.no} voto${data.no === 1 ? "" : "s"}`;
    }

    form.addEventListener("submit", async e => {
      e.preventDefault();
      const choice = document.querySelector('input[name="vote"]:checked');
      if (!choice) {
        alert("Por favor selecciona una opción antes de votar.");
        return;
      }
      const res = await fetch("/vote", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ option: choice.value })
      });
      const data = await res.json();
      updateUI(data);
      form.reset();
    });

    resetButton.addEventListener("click", async () => {
      if (!confirm("¿Seguro que quieres reiniciar la encuesta?")) return;
      const res = await fetch("/reset", { method: "POST" });
      const data = await res.json();
      updateUI(data);
    });

    // Load counts on page load
    fetchCounts();
  </script>
</body>
</html>
